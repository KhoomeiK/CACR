#!/bin/sh
DOWNLOADS="/work/rspandey/train_iais/downloads" ;
singularity exec --nv \
    -B $(pwd):/src \
    -B $DOWNLOADS/finetune:/storage \
    -B $DOWNLOADS/pretrained:/pretrain \
    -B $DOWNLOADS/txt_db:/txt \
    -B $DOWNLOADS/img_db:/img \
    --env NVIDIA_VISIBLE_DEVICES=$CUDA_VISIBLE_DEVICES \
    --pwd /src /work/rspandey/uniter.sif \
    mpirun --oversubscribe --allow-run-as-root --tag-output -np 4 -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x TERM_PROGRAM -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x TERM_PROGRAM_VERSION -x SLURM_CPU_BIND_VERBOSE -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_CPUS_PER_TASK -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x VSCODE_GIT_ASKPASS_EXTRA_ARGS -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x VSCODE_GIT_ASKPASS_MAIN -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x VSCODE_GIT_IPC_HANDLE -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x VSCODE_IPC_HOOK_CLI -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x BROWSER -x VSCODE_GIT_ASKPASS_NODE -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x GIT_ASKPASS -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x COLORTERM -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py --config config/train-siais-large.json --IAIS soft --num_train_steps 1600 --valid_steps 400 --tsa_schedule exp_schedule --checkpoint /storage/itm/flickr/large/ckpt/model_step_1200.pt --output_dir /storage/itm/flickr/large_long5 --warmup_steps 100 --train_batch_size 1
    # mpirun --oversubscribe --allow-run-as-root --tag-output -np 4  -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x TERM_PROGRAM -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x TERM_PROGRAM_VERSION -x SLURM_CPU_BIND_VERBOSE -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_CPUS_PER_TASK -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x VSCODE_GIT_ASKPASS_EXTRA_ARGS -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x VSCODE_GIT_ASKPASS_MAIN -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x VSCODE_GIT_IPC_HANDLE -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x VSCODE_IPC_HOOK_CLI -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x BROWSER -x VSCODE_GIT_ASKPASS_NODE -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x GIT_ASKPASS -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x COLORTERM -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py --config config/train-siais-large.json --IAIS soft --num_train_steps 3200 --valid_steps 200 --tsa_schedule exp_schedule --checkpoint /storage/itm/flickr/large/ckpt/model_step_1800.pt --output_dir /storage/itm/flickr/large_long4 --warmup_steps 0 --train_batch_size 1 # with all layers unfrozen
    # mpirun --oversubscribe --allow-run-as-root --tag-output -np 4  -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x TERM_PROGRAM -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x TERM_PROGRAM_VERSION -x SLURM_CPU_BIND_VERBOSE -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_CPUS_PER_TASK -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x VSCODE_GIT_ASKPASS_EXTRA_ARGS -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x VSCODE_GIT_ASKPASS_MAIN -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x VSCODE_GIT_IPC_HANDLE -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x VSCODE_IPC_HOOK_CLI -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x BROWSER -x VSCODE_GIT_ASKPASS_NODE -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x GIT_ASKPASS -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x COLORTERM -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py --config config/train-siais-large.json --IAIS soft --num_train_steps 3200 --valid_steps 400 --tsa_schedule exp_schedule --checkpoint /storage/itm/flickr/large/ckpt/model_step_1800.pt --output_dir /storage/itm/flickr/large_long3 --warmup_steps 0
    # mpirun --oversubscribe --allow-run-as-root --tag-output -np 4  -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x TERM_PROGRAM -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x TERM_PROGRAM_VERSION -x SLURM_CPU_BIND_VERBOSE -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_CPUS_PER_TASK -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x VSCODE_GIT_ASKPASS_EXTRA_ARGS -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x VSCODE_GIT_ASKPASS_MAIN -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x VSCODE_GIT_IPC_HANDLE -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x VSCODE_IPC_HOOK_CLI -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x BROWSER -x VSCODE_GIT_ASKPASS_NODE -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x GIT_ASKPASS -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x COLORTERM -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py --config config/train-siais-large.json --IAIS soft --num_train_steps 1200 --valid_steps 400 --tsa_schedule exp_schedule --checkpoint /storage/itm/flickr/large_long/ckpt/model_step_1600.pt --output_dir /storage/itm/flickr/large_long2 --warmup_steps 0
    # mpirun --oversubscribe --allow-run-as-root --tag-output -np 4  -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x TERM_PROGRAM -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x TERM_PROGRAM_VERSION -x SLURM_CPU_BIND_VERBOSE -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_CPUS_PER_TASK -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x VSCODE_GIT_ASKPASS_EXTRA_ARGS -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x VSCODE_GIT_ASKPASS_MAIN -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x VSCODE_GIT_IPC_HANDLE -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x VSCODE_IPC_HOOK_CLI -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x BROWSER -x VSCODE_GIT_ASKPASS_NODE -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x GIT_ASKPASS -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x COLORTERM -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py --config config/train-siais-large.json --IAIS soft --num_train_steps 3200 --valid_steps 1600 --tsa_schedule exp_schedule --checkpoint /storage/itm/flickr/large/ckpt/model_step_1800.pt --output_dir /storage/itm/flickr/large_long --warmup_steps 0
    # mpirun --oversubscribe --allow-run-as-root --tag-output -np 4  -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x TERM_PROGRAM -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x TERM_PROGRAM_VERSION -x SLURM_CPU_BIND_VERBOSE -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_CPUS_PER_TASK -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x VSCODE_GIT_ASKPASS_EXTRA_ARGS -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x VSCODE_GIT_ASKPASS_MAIN -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x VSCODE_GIT_IPC_HANDLE -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x VSCODE_IPC_HOOK_CLI -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x BROWSER -x VSCODE_GIT_ASKPASS_NODE -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x GIT_ASKPASS -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x COLORTERM -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py --config config/train-siais-large.json --IAIS soft --num_train_steps 3000 --valid_steps 600 --tsa_schedule exp_schedule
    # mpirun --oversubscribe --allow-run-as-root --tag-output -np 4  -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x TERM_PROGRAM -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x TERM_PROGRAM_VERSION -x SLURM_CPU_BIND_VERBOSE -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x VSCODE_GIT_ASKPASS_EXTRA_ARGS -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x VSCODE_GIT_ASKPASS_MAIN -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x VSCODE_GIT_IPC_HANDLE -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x VSCODE_IPC_HOOK_CLI -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x BROWSER -x VSCODE_GIT_ASKPASS_NODE -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x GIT_ASKPASS -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x COLORTERM -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py  --config config/train-siais-large.json --IAIS soft --num_train_steps 3000 --valid_steps 600 --tsa_schedule exp_schedule
# mpirun --oversubscribe --allow-run-as-root --tag-output -np 2  -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x SLURM_CPU_BIND_VERBOSE -x SSH_TTY -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LS_COLORS -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_CPUS_PER_TASK -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py --config config/train-siais-large.json --IAIS soft --num_train_steps 3000 --valid_steps 600
    # mpirun --oversubscribe --allow-run-as-root --tag-output -np 1  -bind-to none -map-by slot -mca pml ob1 -mca btl ^openib   -x NCCL_DEBUG=INFO  -x _CUDA_COMPAT_STATUS -x SLURM_NODELIST -x SLURM_CHECKPOINT_IMAGE_DIR -x NVIDIA_PYTORCH_VERSION -x MOFED_VERSION -x SLURM_JOB_NAME -x CUDNN_VERSION -x COCOAPI_VERSION -x XDG_SESSION_ID -x TERM_PROGRAM -x SLURM_TOPOLOGY_ADDR -x SLURMD_NODENAME -x HOSTNAME -x SLURM_PRIO_PROCESS -x SLURM_SRUN_COMM_PORT -x NVIDIA_REQUIRE_CUDA -x TERM -x SHELL -x SLURM_PTY_WIN_ROW -x SLURM_JOB_QOS -x NSIGHT_SYSTEMS_VERSION -x HISTSIZE -x CUBLAS_VERSION -x TMPDIR -x SSH_CLIENT -x SLURM_TOPOLOGY_ADDR_PATTERN -x LIBRARY_PATH -x TERM_PROGRAM_VERSION -x SLURM_CPU_BIND_VERBOSE -x ROCKSROOT -x SLURM_CPU_BIND_LIST -x SINGULARITY_COMMAND -x LC_ALL -x ANT_HOME -x USER_PATH -x USER -x SLURM_NNODES -x PYTHONIOENCODING -x NVIDIA_VISIBLE_DEVICES -x LD_LIBRARY_PATH -x SLURM_STEP_NUM_NODES -x SINGULARITY_NAME -x ROCKS_ROOT -x ENV -x SRUN_DEBUG -x SLURM_JOBID -x _CUDA_COMPAT_PATH -x NVIDIA_DRIVER_CAPABILITIES -x CUDA_CACHE_DISABLE -x SLURM_NTASKS -x SLURM_LAUNCH_NODE_IPADDR -x SLURM_STEP_ID -x TRT_VERSION -x CUDA_DRIVER_VERSION -x NVIDIA_BUILD_ID -x SLURM_TASKS_PER_NODE -x SLURM_STEP_LAUNCHER_PORT -x PATH -x MAIL -x SLURM_WORKING_CLUSTER -x SLURM_JOB_ID -x SLURM_CPUS_PER_TASK -x SLURM_STEP_GPUS -x SLURM_STEPID -x SLURM_JOB_USER -x PWD -x _LMFILES_ -x SLURM_SRUN_COMM_HOST -x JAVA_HOME -x CUDA_VISIBLE_DEVICES -x SLURM_CPU_BIND_TYPE -x PYTORCH_VERSION -x LANG -x SLURM_UMASK -x SLURM_PTY_WIN_COL -x PYTORCH_BUILD_VERSION -x MODULEPATH -x SLURM_JOB_UID -x LOADEDMODULES -x VSCODE_GIT_ASKPASS_EXTRA_ARGS -x SLURM_NODEID -x SINGULARITY_ENVIRONMENT -x SLURM_SUBMIT_DIR -x CUDA_VERSION -x SLURM_TASK_PID -x SLURM_NPROCS -x SINGULARITY_BIND -x SLURM_DISTRIBUTION -x SLURM_CPUS_ON_NODE -x SSH_ASKPASS -x SLURM_PROCID -x KRB5CCNAME -x HISTCONTROL -x SLURM_JOB_NODELIST -x OMPI_MCA_btl_vader_single_copy_mechanism -x SLURM_PTY_PORT -x SHLVL -x HOME -x DALI_VERSION -x VSCODE_GIT_ASKPASS_MAIN -x SLURM_LOCALID -x SLURM_JOB_GID -x SLURM_JOB_CPUS_PER_NODE -x SLURM_CLUSTER_NAME -x ROLLSROOT -x SLURM_SUBMIT_HOST -x SLURM_GTIDS -x OPENMPI_VERSION -x NCCL_VERSION -x MPIHOME -x DALI_BUILD -x SLURM_JOB_PARTITION -x BASH_ENV -x LOGNAME -x SLURM_STEP_NUM_TASKS -x VSCODE_GIT_IPC_HANDLE -x SSH_CONNECTION -x SLURM_JOB_ACCOUNT -x GPU_DEVICE_ORDINAL -x VSCODE_IPC_HOOK_CLI -x SLURM_JOB_NUM_NODES -x MODULESHOME -x LESSOPEN -x SLURM_STEP_TASKS_PER_NODE -x PYTORCH_BUILD_NUMBER -x BROWSER -x VSCODE_GIT_ASKPASS_NODE -x SLURM_STEP_NODELIST -x SINGULARITY_CONTAINER -x GIT_ASKPASS -x XDG_RUNTIME_DIR -x SLURM_CPU_BIND -x OMPI_MCA_btl -x COLORTERM -x _ -x _HOROVOD_SECRET_KEY python train_itm_hard_negatives.py --config config/train-siais-base.json --IAIS soft --checkpoint /pretrain/uniter-base.pt --output_dir /storage/itm/flickr/base_test

